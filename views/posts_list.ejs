<!doctype html>
<html>
  <head>
    <title>Community Posts - <%= siteName %></title>
    <link rel="stylesheet" href="<%= basePath %>/main.css" />
  </head>
  <body>
    <%- include('partials/header') %>

    <div class="container">
      <h2 class="page-title">Community Posts</h2>

      <div style="margin-bottom:12px">
        <% if (currentUser) { %>
          <a class="btn" href="<%= basePath %>/posts/new">+ New Post</a>
        <% } else { %>
          <a class="btn small" href="<%= basePath %>/users/login">Log in</a> to create posts.
        <% } %>
      </div>

      <% if (!posts || !posts.length) { %>
        <div class="card"><p>No posts yet.</p></div>
      <% } else { %>
        <ul class="post-list">
          <% posts.forEach(function(p){ %>
            <li>
              <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px">
                <div>
                  <a href="<%= basePath %>/posts/<%= p.id %>"><strong><%= p.title %></strong></a>
                  <div class="meta">
                    by <%= p.username %> â€” 
                    <span class="muted">
                      <%= (p.created_at && p.created_at.toLocaleString) ? p.created_at.toLocaleString() : String(p.created_at) %>
                    </span>
                  </div>
                </div>

                <div>
                  <% if (currentUser && (currentUser === p.username || currentUserRole === 'admin')) { %>
                    <form method="POST" action="<%= basePath %>/posts/<%= p.id %>/delete" style="display:inline">
                      <input type="hidden" name="_csrf" value="<%= csrfToken %>"/>
                      <button class="btn small danger" type="submit" onclick="return confirm('Delete this post?')">Delete</button>
                    </form>
                  <% } %>
                </div>
              </div>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </div>

    <%- include('partials/footer') %>
  </body>
</html>
